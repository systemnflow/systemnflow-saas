<!DOCTYPE html> 
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ronnieâ€™s RAID Extractorâ„¢ | System & Flow</title>
  <meta name="description" content="Paste or upload a transcript, get Risks, Actions, Issues, Decisions instantly with Ronnieâ€™s RAID Extractorâ„¢." /> 
  <meta name="theme-color" content="#0b1220" />
  <meta name="robots" content="index,follow" />

  <!-- Favicons -->
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicon-16x16.png" />
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/img/apple-touch-icon.png" />
  <link rel="manifest" href="/assets/img/site.webmanifest" />

  <!-- Styles -->
  <link rel="stylesheet" href="/styles.css" />
  <style>
    .toggle { cursor: pointer; color: var(--accent); font-weight: 600; margin-top:1rem; }
    .toggle:hover { text-decoration: underline; }
    .hidden { display:none; }
    #usageCounter { text-align:center; font-size:0.9rem; margin-top:0.5rem; color:var(--muted); }
    .suggestions { margin-top:2rem; padding:1rem; border:1px dashed var(--border); border-radius:8px; background:var(--panel); color:var(--muted); }
    .suggestions h2 { color:var(--ink); margin-bottom:0.5rem; }
    .badge { display:inline-block; padding:0.25rem 0.6rem; border-radius:6px; font-size:0.8rem; font-weight:600; }
    .badge.high { background:#40d27833; color:#40d278; }
    .badge.med { background:#ffa50033; color:#ffa500; }
    .badge.low { background:#ff444433; color:#ff4444; }
    ul { margin:0.5rem 0 1.25rem 1.25rem; }
    li { margin:0.3rem 0; }
    .error { color:#ff4444; font-size:0.9rem; margin-top:1rem; }
    .locked { opacity:0.5; cursor:not-allowed; position:relative; }
    .locked::after {
      content:"ðŸ”’ Pro Only"; 
      position:absolute; top:50%; left:50%; 
      transform:translate(-50%, -50%);
      background:rgba(0,0,0,0.75); color:#fff; 
      padding:0.2rem 0.5rem; border-radius:4px;
      font-size:0.75rem; white-space:nowrap;
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="site-header">
    <div class="container">
      <a href="/" class="brand-wrap" aria-label="System & Flow homepage">
        <img src="/assets/img/logo.png" alt="System & Flow logo" />
        <span class="brand">System & Flow</span>
      </a>
      <nav>
        <ul class="nav-links">
          <li><a href="/">Home</a></li>
          <li><a href="/apps.html">Tools</a></li>
          <li><a href="/contact.html">Contact</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <!-- Main -->
  <main class="container" style="max-width: 900px; margin: 4rem auto; padding: 2rem;">
    <h1 style="text-align:center;">Ronnieâ€™s RAID Extractorâ„¢ (Free)</h1>
    <p style="text-align:center; color: var(--muted); margin-bottom: 2rem;">
      Paste a transcript <em>or upload a document</em>. Ronnie will extract 
      <strong>âš  Risks</strong>, <strong>âœ… Actions</strong>, 
      <strong>ðŸ›‘ Issues</strong>, and <strong>ðŸ“Œ Decisions</strong>.
    </p>

    <!-- Confidence Score -->
    <div id="confidence" style="text-align:center; margin-bottom:1rem; font-size:0.95rem; color:var(--muted);">
      Ronnieâ€™s Confidence Score: 
      <span id="conf-score" class="badge low">0%</span>
    </div>

    <!-- Transcript Input -->
    <textarea id="input" rows="12" placeholder="Enter text here..."
      style="width:100%; padding:1rem; border-radius:10px; border:1px solid var(--border); background:var(--panel); color:var(--ink);"></textarea>

    <!-- File Upload -->
    <div style="margin:1rem 0;">
      <label for="fileInput" style="display:block; margin-bottom:0.5rem; color:var(--muted); font-size:0.9rem;">
        Or upload a transcript (.txt, .docx, .pdf)
      </label>
      <input type="file" id="fileInput" accept=".txt,.docx,.pdf" style="color:var(--ink);" />
      <div id="fileError" class="error" style="display:none;"></div>
    </div>

    <!-- Action Buttons -->
    <div style="margin-top:1.5rem; display:flex; gap:1rem; flex-wrap:wrap;">
      <button id="run" class="button primary">Extract RAID</button>
      <button id="clear" class="button ghost">Clear & Reset</button>
      <button id="download" class="button ghost locked">Download CSV</button>
      <button id="downloadExcel" class="button ghost locked">Download Excel</button>
      <button id="downloadPDF" class="button ghost locked">Download PDF</button>
      <button id="copy" class="button ghost">Copy to Clipboard</button>
    </div>

    <!-- Usage Counter -->
    <div id="usageCounter"></div>

    <!-- RAID Output -->
    <div id="output" style="margin-top:2rem;"></div>

    <!-- Resolution Suggestions (Free teaser) -->
    <div id="suggestions" class="suggestions">
      <h2>ðŸ’¡ Resolution Suggestions (Pro Only)</h2>
      <p style="font-size:0.9rem; margin-bottom:0.75rem;">
        Pro users unlock AI-powered guidance to help resolve project issues.<br/>
        Example: <em>"Clarify ownership in the project charter to prevent repeat delays."</em>
      </p>
      <a href="/pricing.html" class="button ghost">Upgrade to Pro</a>
    </div>

    <!-- Pro Teaser -->
    <div id="pro-banner" style="margin-top:2rem; text-align:center; padding:1rem; border:1px dashed var(--border); border-radius:8px; background:var(--panel); color:var(--muted);">
      <p>ðŸ”’ <strong>Pro Feature:</strong> Save RAID History + Multi-format Exports</p>
      <p style="font-size:0.9rem; color:var(--muted);">Upgrade to Pro for unlimited runs, saved logs, and exports in Excel, PDF, Word, Markdown, JSON.</p>
      <a href="/pricing.html" class="button ghost">Upgrade to Pro</a>
    </div>
  </main>

  <!-- Footer -->
  <footer class="footer-min">
    <div class="container footer-container">
      <div class="foot-left">
        <img class="logo-icon" src="/assets/img/logo.png" alt="System & Flow logo icon" />
        <span class="brand">System & Flow</span>
        <span class="divider">â€¢</span>
        <span class="tagline">Smarter tools. Faster PMs.</span>
      </div>
      <div class="foot-right">
        <a href="https://www.tiktok.com/@systemnflow" target="_blank">TikTok</a>
        <a href="https://www.instagram.com/systemnflow" target="_blank">Instagram</a>
        <a href="https://www.pinterest.com/systemnflow" target="_blank">Pinterest</a>
        <a href="https://www.youtube.com/@Systemnflow" target="_blank">YouTube</a>
        <a href="https://www.linkedin.com/company/systemnflow" target="_blank">LinkedIn</a>
      </div>
    </div>
    <div class="legal">Â© <span id="y"></span> System & Flowâ„¢. All rights reserved.</div>
  </footer>

  <!-- Scripts -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.4.2/mammoth.browser.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
  <script>
    document.getElementById("y").textContent = new Date().getFullYear();

    const maxFreeRuns = 5;
    let freeRuns = parseInt(localStorage.getItem("raidFreeRuns") || "0", 10);
    const usageCounter = document.getElementById("usageCounter");

    function updateCounter() {
      const remaining = Math.max(0, maxFreeRuns - freeRuns);
      usageCounter.textContent = remaining > 0 
        ? `ðŸ†“ You have ${remaining} free run${remaining !== 1 ? "s" : ""} left`
        : "ðŸš€ Free limit reached â€” Upgrade to Pro";
    }
    updateCounter();

    function cleanLine(line) {
      return line
        .replace(/\[[0-9:]+\]/g, "")                
        .replace(/\b(um|uh|so|like|yeah)\b/gi, "")  
        .replace(/\s*,\s*,/g, ",")                  
        .replace(/\s+,/g, ",")                      
        .replace(/,\s+/g, ", ")                     
        .replace(/\s+/g, " ")                       
        .trim();
    }

    function formatRAID(categories, conf) {
      let out = `Confidence: ${conf}%\n\n`;
      for (const [key, arr] of Object.entries(categories)) {
        out += `${key}:\n`;
        out += arr.length 
          ? arr.map(l => "  â€¢ " + cleanLine(l)).join("\n") 
          : "  â€¢ None";
        out += "\n\n";
      }
      return out.trim();
    }

    function extractRAID() {
      if (freeRuns >= maxFreeRuns) return;
      freeRuns++; localStorage.setItem("raidFreeRuns", freeRuns); updateCounter();

      const text = document.getElementById("input").value;
      const output = document.getElementById("output");
      if (!text.trim()) { 
        output.innerHTML = "<p style='color:var(--muted)'>Paste or upload a transcript.</p>"; 
        document.getElementById("conf-score").textContent = "0%"; 
        return; 
      }

      const cats = { Risks:[], Actions:[], Issues:[], Decisions:[] };
      const lines = text.split(/\r?\n/);

      lines.forEach(l => {
        if (/risk/i.test(l)) cats.Risks.push(l);
        else if (/action/i.test(l)) cats.Actions.push(l);
        else if (/issue/i.test(l)) cats.Issues.push(l);
        else if (/decision/i.test(l)) cats.Decisions.push(l);
      });

      const tagged = Object.values(cats).reduce((a,b)=>a+b.length,0);
      const conf = Math.round((tagged / (lines.filter(l => l.trim()).length || 1)) * 100);

      const scoreEl = document.getElementById("conf-score");
      scoreEl.textContent = isNaN(conf) ? "0%" : conf+"%";
      scoreEl.className = "badge " + (conf>=70?"high":conf>=40?"med":"low");

      let html="";
      for (const [k,v] of Object.entries(cats)) {
        const icon = k==="Risks"?"âš ":k==="Actions"?"âœ…":k==="Issues"?"ðŸ›‘":"ðŸ“Œ";
        html += `<div style="margin-bottom:2rem;">`;   // ðŸ”¹ added spacing wrapper
        html += `<h3>${icon} ${k} (${v.length})</h3><ul>`;
        html += v.length 
          ? v.map(l => `<li>${cleanLine(l)}</li>`).join("") 
          : `<li><em>No ${k.toLowerCase()} found.</em></li>`;
        html += "</ul></div>";  // ðŸ”¹ close spacing wrapper
    }
output.innerHTML = html;

    }

    // Copy to Clipboard works again
    document.getElementById("copy").onclick = async () => { 
      const text = document.getElementById("output").innerText;
      await navigator.clipboard.writeText(text); 
      alert("ðŸ“‹ Copied!"); 
    };

    // Keep downloads locked
    document.querySelectorAll(".locked").forEach(btn => {
      btn.addEventListener("click", e => {
        e.preventDefault();
        alert("ðŸ”’ Pro feature â€” upgrade to unlock exports.");
      });
    });

    // File input handler
    document.getElementById("fileInput").addEventListener("change", async (e) => {
      const f = e.target.files[0]; if(!f) return;
      try {
        if(f.name.endsWith(".txt")){
          document.getElementById("input").value=await f.text(); extractRAID();
        }
        else if(f.name.endsWith(".docx")){
          const r=new FileReader(); 
          r.onload=async(ev)=>{ const res=await mammoth.extractRawText({arrayBuffer:ev.target.result}); document.getElementById("input").value=res.value; extractRAID(); }; 
          r.readAsArrayBuffer(f);
        }
        else if(f.name.endsWith(".pdf")){
          const r=new FileReader(); 
          r.onload=async(ev)=>{ 
            const arr=new Uint8Array(ev.target.result); 
            const pdf=await pdfjsLib.getDocument(arr).promise; 
            let t=""; 
            for(let i=1;i<=pdf.numPages;i++){ 
              const p=await pdf.getPage(i); 
              const txt=await p.getTextContent(); 
              t+=txt.items.map(s=>s.str).join(" ")+"\\n"; 
            } 
            document.getElementById("input").value=t; extractRAID(); 
          }; 
          r.readAsArrayBuffer(f);
        }
        else {
          document.getElementById("fileError").style.display="block";
          document.getElementById("fileError").textContent="âŒ Unsupported file format.";
        }
      } catch(err) {
        document.getElementById("fileError").style.display="block";
        document.getElementById("fileError").textContent="âŒ Error reading file.";
      }
    });

    document.getElementById("run").onclick = extractRAID;
    document.getElementById("clear").onclick = () => { 
      document.getElementById("input").value=""; 
      document.getElementById("output").innerHTML=""; 
      document.getElementById("conf-score").textContent="0%"; 
      document.getElementById("conf-score").className="badge low"; 
    };
  </script>
</body>
</html>
