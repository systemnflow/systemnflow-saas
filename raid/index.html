<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ronnie‚Äôs RAID Extractor‚Ñ¢ | System & Flow</title>
  <meta name="description" content="Paste or upload a transcript, get Risks, Actions, Issues, and Decisions instantly with Ronnie‚Äôs RAID Extractor‚Ñ¢." />
  <meta name="theme-color" content="#0b1220" />
  <meta name="robots" content="index,follow" />

  <!-- Styles -->
  <link rel="stylesheet" href="/styles.css" />
  <style>
    .toggle { cursor: pointer; color: var(--accent); font-weight: 600; margin-top:1rem; }
    .toggle:hover { text-decoration: underline; }
    .hidden { display:none; }
    mark { background: #ffd54f; padding: 0 2px; border-radius:2px; }
    #usageCounter { text-align:center; font-size:0.9rem; margin-top:0.5rem; color:var(--muted); }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="site-header">
    <div class="container">
      <a href="/" class="brand-wrap" aria-label="System & Flow homepage">
        <img src="/assets/img/logo.png" alt="System & Flow logo" />
        <span class="brand">System & Flow</span>
      </a>
      <nav>
        <ul class="nav-links">
          <li><a href="/">Home</a></li>
          <li><a href="/apps.html">Tools</a></li>
          <li><a href="/contact.html">Contact</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <!-- Main -->
  <main class="container" style="max-width: 900px; margin: 4rem auto; padding: 2rem;">
    <h1 style="text-align:center;">Ronnie‚Äôs RAID Extractor‚Ñ¢ (Free)</h1>
    <p style="text-align:center; color: var(--muted); margin-bottom: 2rem;">
      Paste a transcript <em>or upload a document</em>. Ronnie will extract 
      <strong>‚ö†Ô∏è Risks</strong>, <strong>‚úÖ Actions</strong>, 
      <strong>üõë Issues</strong>, and <strong>üìå Decisions</strong>.
    </p>

    <!-- Confidence Score -->
    <div id="confidence" style="text-align:center; margin-bottom:1rem; font-size:0.95rem; color:var(--muted);">
      Ronnie‚Äôs Confidence Score: <span id="conf-score" style="font-weight:600;">0%</span>
    </div>

    <!-- Transcript Input -->
    <textarea id="input" rows="12"
      style="width:100%; padding:1rem; border-radius:10px; border:1px solid var(--border); background:var(--panel); color:var(--ink);"></textarea>

    <!-- File Upload -->
    <div style="margin:1rem 0;">
      <label for="fileInput" style="display:block; margin-bottom:0.5rem; color:var(--muted); font-size:0.9rem;">
        Or upload a transcript (.txt, .docx, .pdf)
      </label>
      <input type="file" id="fileInput" accept=".txt,.docx,.pdf" style="color:var(--ink);" />
    </div>

    <!-- Action Buttons -->
    <div style="margin-top:1.5rem; display:flex; gap:1rem; flex-wrap:wrap;">
      <button id="run" class="button primary">Extract RAID</button>
      <button id="clear" class="button ghost">Clear & Reset</button>
      <button id="download" class="button ghost">Download CSV</button>
      <button id="downloadExcel" class="button ghost pro-only">Download Excel</button>
      <button id="downloadPDF" class="button ghost pro-only">Download PDF</button>
      <button id="copy" class="button ghost">Copy to Clipboard</button>
    </div>

    <!-- Usage Counter -->
    <div id="usageCounter"></div>

    <div id="output" style="margin-top:2rem;"></div>

    <!-- Pro Feature Teaser -->
    <div id="pro-banner" style="margin-top:2rem; text-align:center; padding:1rem; border:1px dashed var(--border); border-radius:8px; background:var(--panel); color:var(--muted);">
      <p>üîí <strong>Pro Feature:</strong> Save RAID History</p>
      <p style="font-size:0.9rem; color:var(--muted);">
        Pro users can save RAID logs to build project knowledge over time and track risks, actions, and decisions across meetings.
      </p>
      <button class="button ghost pro-only">Save RAID Log (Pro)</button>
    </div>
  </main>

  <!-- Modal -->
  <div id="paywallModal" class="modal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.7); justify-content:center; align-items:center; z-index:1000;">
    <div class="modal-content" style="background:var(--panel); padding:2rem; border-radius:10px; text-align:center; max-width:400px; color:var(--ink);">
      <h2>üöÄ You‚Äôve hit the free limit</h2>
      <p>You‚Äôve used your 5 free runs. Upgrade to <strong>Ronnie‚Äôs RAID Extractor‚Ñ¢ Pro</strong> for unlimited use + Excel/PDF exports.</p>
      <a href="/pricing.html" class="button primary">Upgrade to Pro</a><br/>
      <button id="closeModal" class="button ghost" style="margin-top:0.5rem;">Cancel</button>
    </div>
  </div>

  <!-- Footer -->
  <footer class="footer-min">
    <div class="container footer-container">
      <div class="foot-left">
        <img class="logo-icon" src="/assets/img/logo.png" alt="System & Flow logo icon" />
        <span class="brand">System & Flow</span>
        <span class="divider">‚Ä¢</span>
        <span class="tagline">Smarter tools. Faster PMs.</span>
      </div>
      <div class="foot-right">
        <a href="https://www.tiktok.com/@systemnflow" target="_blank">TikTok</a>
        <a href="https://www.instagram.com/systemnflow" target="_blank">Instagram</a>
        <a href="https://www.pinterest.com/systemnflow" target="_blank">Pinterest</a>
        <a href="https://www.youtube.com/@Systemnflow" target="_blank">YouTube</a>
        <a href="https://www.linkedin.com/company/systemnflow" target="_blank">LinkedIn</a>
      </div>
    </div>
    <div class="legal">¬© <span id="y"></span> System & Flow‚Ñ¢. All rights reserved.</div>
  </footer>

  <!-- Scripts -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.4.2/mammoth.browser.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
  <script>
    document.getElementById("y").textContent = new Date().getFullYear();

    // Track free usage
    const maxFreeRuns = 5;
    let freeRuns = parseInt(localStorage.getItem("raidFreeRuns") || "0", 10);

    const usageCounter = document.getElementById("usageCounter");
    function updateCounter() {
      const remaining = Math.max(0, maxFreeRuns - freeRuns);
      usageCounter.textContent = remaining > 0 
        ? `üÜì You have ${remaining} free run${remaining !== 1 ? "s" : ""} left`
        : "üöÄ Free limit reached ‚Äî Upgrade to Pro for unlimited use";
    }
    updateCounter();

    // Paywall
    const modal = document.getElementById("paywallModal");
    document.querySelectorAll(".pro-only").forEach(btn => {
      btn.addEventListener("click", e => { e.preventDefault(); modal.style.display = "flex"; });
    });
    document.getElementById("closeModal").onclick = () => modal.style.display = "none";

    // RAID Extraction Function
    function extractRAID() {
      if (freeRuns >= maxFreeRuns) {
        modal.style.display = "flex";
        return;
      }

      freeRuns++;
      localStorage.setItem("raidFreeRuns", freeRuns);
      updateCounter();

      const text = document.getElementById("input").value;
      const output = document.getElementById("output");
      if (!text.trim()) {
        output.innerHTML = "<p style='color:var(--muted)'>Please paste or upload a transcript.</p>";
        document.getElementById("conf-score").textContent = "0%";
        return;
      }

      const categories = { Risks: [], Actions: [], Issues: [], Decisions: [] };
      const lines = text.split(/\r?\n/);
      lines.forEach(line => {
        if (/risk/i.test(line)) categories.Risks.push(line);
        else if (/action/i.test(line)) categories.Actions.push(line);
        else if (/issue/i.test(line)) categories.Issues.push(line);
        else if (/decision/i.test(line)) categories.Decisions.push(line);
      });

      const tagged = Object.values(categories).reduce((a,b)=>a+b.length,0);
      const score = Math.round((tagged / lines.length) * 100);
      const scoreEl = document.getElementById("conf-score");
      scoreEl.textContent = isNaN(score) ? "0%" : score + "%";
      scoreEl.style.color = score >= 70 ? "limegreen" : score >= 40 ? "orange" : "red";

      let html = "";
      for (const [key, arr] of Object.entries(categories)) {
        html += `<div class="toggle" onclick="this.nextElementSibling.classList.toggle('hidden')">${key} (${arr.length})</div>`;
        html += `<ul>`;
        if (arr.length) arr.forEach(l => html += `<li>${l}</li>`);
        else html += `<li><em>No ${key.toLowerCase()} found.</em></li>`;
        html += `</ul>`;
      }
      output.innerHTML = html;
    }

    // File Upload + Clear
    document.getElementById("fileInput").addEventListener("change", async (e) => {
      const file = e.target.files[0];
      if (!file) return;
      if (file.name.endsWith(".txt")) {
        document.getElementById("input").value = await file.text();
        extractRAID();
      }
    });
    document.getElementById("run").addEventListener("click", extractRAID);
    document.getElementById("clear").addEventListener("click", () => { 
      document.getElementById("input").value="";
      document.getElementById("output").innerHTML="";
      document.getElementById("conf-score").textContent="0%";
    });
  </script>
</body>
</html>
