<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Saved RAID Logs | Ronnie’s RAID Extractor™ Pro</title>
  <meta name="description" content="View and manage saved RAID logs in Ronnie’s RAID Extractor™ Pro." />
  <meta name="theme-color" content="#0b1220" />

  <!-- Favicons -->
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicon-16x16.png" />
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/img/apple-touch-icon.png" />
  <link rel="manifest" href="/assets/img/site.webmanifest" />

  <!-- Styles -->
  <link rel="stylesheet" href="/styles.css" />
</head>

<body>
  <!-- Header -->
  <header class="site-header">
    <div class="container">
      <a href="/" class="brand-wrap" aria-label="System & Flow homepage">
        <img src="/assets/img/logo.png" alt="System & Flow logo" />
        <span class="brand">System & Flow</span>
      </a>
      <nav>
        <ul class="nav-links">
          <li><a href="/">Home</a></li>
          <li><a href="/apps.html">Tools</a></li>
          <li><a href="/contact.html">Contact</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <!-- Main -->
  <main class="container" style="max-width: 1000px; margin: 4rem auto; padding: 2rem;">
    <h1 style="text-align:center;">📂 Saved RAID Logs</h1>
    <p style="text-align:center; color: var(--muted); margin-bottom: 2rem;">
      Manage your RAID history. Search, filter, export, or restore logs.
    </p>

    <!-- Search & Filter -->
    <div style="display:flex; gap:1rem; flex-wrap:wrap; margin-bottom:2rem;">
      <input id="searchBox" type="text" placeholder="🔎 Search logs..."
        style="flex:1; padding:0.75rem; border-radius:8px; border:1px solid var(--border); background:var(--panel); color:var(--ink);" />
      <select id="filterType" 
        style="padding:0.75rem; border-radius:8px; border:1px solid var(--border); background:var(--panel); color:var(--ink);">
        <option value="">Filter: All</option>
        <option value="Risk">Risks</option>
        <option value="Action">Actions</option>
        <option value="Issue">Issues</option>
        <option value="Decision">Decisions</option>
      </select>
    </div>

    <!-- Logs List -->
    <div id="logsList" style="display:grid; gap:1.5rem;"></div>

    <!-- Bulk Actions -->
    <div style="margin-top:2rem; text-align:center;">
      <button id="exportAll" class="button ghost">⬇ Export All (JSON)</button>
      <button id="importLogs" class="button ghost">⬆ Import Logs</button>
      <button id="clearAll" class="button ghost" style="margin-left:1rem;">🗑 Clear All</button>
    </div>

    <!-- Coming Soon -->
    <div style="margin-top:3rem; text-align:center; padding:1rem; border:1px dashed var(--border); border-radius:8px;">
      <h2>🚀 Coming Soon</h2>
      <ul style="color:var(--muted); line-height:1.8; list-style:none; padding:0;">
        <li>📊 RAID Analytics Dashboard (trends & insights)</li>
        <li>🤝 Team Sharing & Collaboration</li>
        <li>🔗 Integrations: Jira, Notion, Excel Online</li>
      </ul>
    </div>
  </main>

  <!-- Footer -->
  <footer class="footer-min">
    <div class="container footer-container">
      <div class="foot-left">
        <img class="logo-icon" src="/assets/img/logo.png" alt="System & Flow logo" />
        <span class="brand">System & Flow</span>
        <span class="divider">•</span>
        <span class="tagline">Smarter tools. Faster PMs.</span>
      </div>
      <div class="foot-right">
        <a href="https://www.tiktok.com/@systemnflow" target="_blank" rel="noopener">TikTok</a>
        <a href="https://www.instagram.com/systemnflow" target="_blank" rel="noopener">Instagram</a>
        <a href="https://www.pinterest.com/systemnflow" target="_blank" rel="noopener">Pinterest</a>
        <a href="https://www.youtube.com/@Systemnflow" target="_blank" rel="noopener">YouTube</a>
        <a href="https://www.linkedin.com/company/systemnflow" target="_blank" rel="noopener">LinkedIn</a>
        <a href="https://www.facebook.com/systemnflow" target="_blank" rel="noopener">Facebook</a>
      </div>
    </div>
    <div class="legal">© <span id="y"></span> System & Flow™. All rights reserved.</div>
  </footer>

  <!-- Scripts -->
  <script>
    document.getElementById("y").textContent = new Date().getFullYear();

    function renderLogs() {
      const logs = JSON.parse(localStorage.getItem("raidLogs") || "[]");
      const search = document.getElementById("searchBox").value.toLowerCase();
      const filter = document.getElementById("filterType").value;
      const logsList = document.getElementById("logsList");
      logsList.innerHTML = "";

      logs.forEach((log, index) => {
        if (
          (search && !log.content.toLowerCase().includes(search)) ||
          (filter && !log.content.includes(filter))
        ) return;

        const card = document.createElement("div");
        card.style.border = "1px solid var(--border)";
        card.style.padding = "1rem";
        card.style.borderRadius = "8px";
        card.style.background = "var(--panel)";
        card.innerHTML = `
          <p style="color:var(--muted); font-size:0.9rem;">📅 ${new Date(log.date).toLocaleString()}</p>
          <pre style="white-space:pre-wrap; color:var(--ink); margin:1rem 0;">${log.content}</pre>
          <div style="display:flex; gap:0.5rem; flex-wrap:wrap;">
            <button onclick="exportLog(${index}, 'csv')" class="button ghost">⬇ CSV</button>
            <button onclick="exportLog(${index}, 'txt')" class="button ghost">⬇ TXT</button>
            <button onclick="exportLog(${index}, 'pdf')" class="button ghost">⬇ PDF</button>
            <button onclick="exportLog(${index}, 'json')" class="button ghost">⬇ JSON</button>
            <button onclick="copyLog(${index})" class="button ghost">📋 Copy</button>
            <button onclick="restoreLog(${index})" class="button ghost">↩ Restore</button>
            <button onclick="deleteLog(${index})" class="button ghost">🗑 Delete</button>
          </div>
        `;
        logsList.appendChild(card);
      });
    }

    function exportLog(index, format) {
      const logs = JSON.parse(localStorage.getItem("raidLogs") || "[]");
      const log = logs[index];
      let blob;

      switch (format) {
        case "csv":
          blob = new Blob([`"Date","Content"\n"${log.date}","${log.content.replace(/"/g, '""')}"`], { type: "text/csv" });
          break;
        case "txt":
          blob = new Blob([`${log.date}\n\n${log.content}`], { type: "text/plain" });
          break;
        case "json":
          blob = new Blob([JSON.stringify(log, null, 2)], { type: "application/json" });
          break;
        case "pdf":
          blob = new Blob([`${log.date}\n\n${log.content}`], { type: "application/pdf" });
          break;
      }

      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = `raid-log-${index + 1}.${format}`;
      a.click();
    }

    function copyLog(index) {
      const logs = JSON.parse(localStorage.getItem("raidLogs") || "[]");
      navigator.clipboard.writeText(logs[index].content);
      alert("📋 Log copied to clipboard!");
    }

    function restoreLog(index) {
      const logs = JSON.parse(localStorage.getItem("raidLogs") || "[]");
      localStorage.setItem("restoreLog", logs[index].content);
      alert("↩ Log restored! Go back to the Extractor page.");
      window.location.href = "/raid-pro/index.html";
    }

    function deleteLog(index) {
      let logs = JSON.parse(localStorage.getItem("raidLogs") || "[]");
      logs.splice(index, 1);
      localStorage.setItem("raidLogs", JSON.stringify(logs));
      renderLogs();
    }

    document.getElementById("exportAll").addEventListener("click", () => {
      const logs = JSON.parse(localStorage.getItem("raidLogs") || "[]");
      const blob = new Blob([JSON.stringify(logs, null, 2)], { type: "application/json" });
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "all-raid-logs.json";
      a.click();
    });

    document.getElementById("importLogs").addEventListener("click", () => {
      const input = document.createElement("input");
      input.type = "file";
      input.accept = "application/json";
      input.onchange = e => {
        const file = e.target.files[0];
        const reader = new FileReader();
        reader.onload = () => {
          try {
            const newLogs = JSON.parse(reader.result);
            localStorage.setItem("raidLogs", JSON.stringify(newLogs));
            renderLogs();
            alert("✅ Logs imported!");
          } catch {
            alert("❌ Invalid JSON file.");
          }
        };
        reader.readAsText(file);
      };
      input.click();
    });

    document.getElementById("clearAll").addEventListener("click", () => {
      if (confirm("Are you sure you want to clear all logs?")) {
        localStorage.removeItem("raidLogs");
        renderLogs();
      }
    });

    document.getElementById("searchBox").addEventListener("input", renderLogs);
    document.getElementById("filterType").addEventListener("change", renderLogs);

    // 🔐 License enforcement
    if (localStorage.getItem("proUser") !== "true") {
      alert("❌ Pro license required to view logs.");
      window.location.href = "/raid-pro/index.html";
    }

    renderLogs();
  </script>
</body>
</html>
